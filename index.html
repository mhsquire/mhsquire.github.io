<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Mosaic</title>
</head>
<body>
<style>.hidden { display:none; } </style>
<img id="mare" src="/mare.jpg" alt="Beautiful white horse." class="hidden">
<canvas id="mosaicCanvas">

</canvas>
<canvas id="picCanvas"></canvas>
<script>
    const Point2D = function(x, y) { this.x = x; this.y = y; };

    let QuadTile = function(point1, point2) {

        let a1 = Math.PI - Math.random() * Math.PI / 3;
        let a2 = Math.PI - Math.random() * Math.PI / 3;
        let size = Math.random() * 25 + 25;


        this.point1 = point1;
        this.point2 = point2;
        this.point3 = new Point2D(point2.x - size, point2.y);
        this.point4 = new Point2D(point1.x - size, point1.y);
        this.grey = Math.random()*100 + 50;
    }

    let Tiles = function(height, width) {
        this.tiles = [];
        let h = height;
        while (h > 0) {
            let w = width;
            let old_tile = new QuadTile(new Point2D(w, h), new Point2D(w, h - 25))
            this.tiles.push(old_tile)
            h = h - 25;
            while (w > 0) {
                let tile = new QuadTile(old_tile.point4, old_tile.point3);
                this.tiles.push(tile);
                old_tile = tile;
                w = w - (tile.point1.x - tile.point4.x);
            }
        }
    }

    function loadFile(filePath) {
        var result = null;
        var xmlhttp = new XMLHttpRequest();
        xmlhttp.open("GET", filePath, false);
        xmlhttp.send();
        if (xmlhttp.status==200) {
            result = xmlhttp.responseText;
        }
        return result;
    }

    let PictureTiles = function() {
        const picContext = picCanvas.getContext("2d");
        const width = 640;
        const height = 426;

        picCanvas.width = width;
        picCanvas.height = height;
        picContext.drawImage(img, 0,0, width, height);
        const picData = picContext.getImageData(0, 0, 640, 426);

        console.log(picData);
        let tiles = [];
        let size = 0;
        for (let index = 0; index < picData.length; index++) {
            let character = picData[index];
            if (character === ';') {
                tiles.push(

                )
            }
        }
    }

    let context = document.getElementById("mosaicCanvas").getContext("2d");
    const img = document.getElementById("mare");
    let picCanvas = document.getElementById("picCanvas");
    let height = document.documentElement.clientHeight;
    let width = document.documentElement.clientWidth;
    let mosaic = new Tiles(height, width);
    console.log(picCanvas)
    let horse = new PictureTiles();
    console.log(mosaic)

    let do_once = function loop() {

        window.requestAnimationFrame(loop);

        height = document.documentElement.clientHeight;
        width = document.documentElement.clientWidth;
        context.canvas.height = height;
        context.canvas.width = width;

        context.fillStyle = "#202020";
        context.fillRect(0, 0, width, height);

        context.strokeStyle = "#f0f0f0";

        for(let index = mosaic.tiles.length - 1; index > -1; index--) {
            context.fillStyle = `rgb(${mosaic.tiles[index].grey}, ${mosaic.tiles[index].grey}, ${mosaic.tiles[index].grey})`;
            context.beginPath();
            context.moveTo(mosaic.tiles[index].point1.x, mosaic.tiles[index].point1.y);
            context.lineTo(mosaic.tiles[index].point2.x, mosaic.tiles[index].point2.y);
            context.lineTo(mosaic.tiles[index].point3.x, mosaic.tiles[index].point3.y);
            context.lineTo(mosaic.tiles[index].point4.x, mosaic.tiles[index].point4.y)
            context.closePath();
            context.fill();
            context.stroke();
        }

    }
   // do_once()

</script>

</body>
</html>